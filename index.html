<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3C Content Schedule Planner</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/png" href="public/favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://unpkg.com/fullcalendar@6.1.10/index.global.min.css">
    <script src="https://unpkg.com/fullcalendar@6.1.10/index.global.min.js"></script>
    <link rel="stylesheet" href="css/styles.css?v=1.1.4">
    <link rel="stylesheet" href="css/navigation.css?v=1.0.5">
    <link rel="stylesheet" href="css/nav-toggle.css">
    
    <!-- Supabase Configuration - Load from config.js -->
    <script src="config.js"></script>
</head>
<body>
    <header class="header">
        <div class="logo-section">
            <img src="public/logo.png" alt="3C Logo" class="logo">
            <h1 class="title">3C Content Schedule Planner</h1>
        </div>
        <div class="header-buttons">
            <button id="jan-assistant-btn" class="btn btn-jan-profile" onclick="toggleJanChat()" title="Chat with Jan - AI Assistant">
                <img src="public/jan-profile.png" alt="Jan AI Assistant" class="jan-profile-img">
            </button>
            <button id="supabase-indicator" class="btn btn-traffic-light" title="Supabase Connection">
                üö¶
            </button>
            <button class="btn btn-speaker" onclick="openCreatePostModal()" title="Create New Post">
                üîä
            </button>
            <button class="btn btn-speaker" onclick="window.location.href='links-manager.html'" title="Manage Navigation Links">
                üîó
            </button>
            <button id="signout-btn" class="btn btn-speaker" onclick="signOut()" title="Sign Out">
                üö™
            </button>
        </div>
    </header>

    <!-- Navigation Panel -->
    <div id="nav-panel">
        <div class="nav-content">
            <a href="#" class="nav-icon" title="Memos">
                üìÆ
            </a>
            <a href="#" class="nav-icon" title="Voice Memo">
                üé§
            </a>
            <a href="#" class="nav-icon" title="Chatroom">
                üë•
            </a>
            <a href="#" class="nav-icon" title="AI Assistant">
                üí°
            </a>
            <a href="#" class="nav-icon" title="Supabase">
                üí∫
            </a>
            <a href="#" class="nav-icon" title="Cloudflare">
                üîã
            </a>
            <a href="#" class="nav-icon" title="Password Manager">
                üîè
            </a>
            <a href="#" class="nav-icon mobile-view" title="Mobile View">
                üì±
            </a>
            <a href="/" class="nav-icon" title="Back to Dashboard">
                üîô
            </a>
        </div>
    </div>

    <!-- Navigation Toggle Container near Calendar -->
    <div id="nav-toggle-container">
        <button id="nav-toggle-btn" onclick="toggleNavPanel()" title="Navigation Menu">
            üíé
        </button>
    </div>

    <div class="container">
        <div class="calendar-container">
            <div id="calendar"></div>
        </div>
    </div>

    <div id="postModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Create New Post</h2>
                <button class="close-btn" onclick="closePostModal()">&times;</button>
            </div>
            <form id="postForm" onsubmit="handlePostSubmit(event)">
                <!-- Auth Check -->
                <script>
                    // Check if user is logged in before loading app
                    window.addEventListener('DOMContentLoaded', async () => {
                        // Get credentials from config.js only
                        const url = typeof SUPABASE_URL !== 'undefined' ? SUPABASE_URL : '';
                        const key = typeof SUPABASE_ANON_KEY !== 'undefined' ? SUPABASE_ANON_KEY : '';
                        
                        if (url && key && url !== '' && key !== '') {
                            try {
                                const client = supabase.createClient(url, key);
                                const { data: { session } } = await client.auth.getSession();
                                
                                if (!session) {
                                    // Not logged in, redirect to login page
                                    window.location.href = 'login.html';
                                }
                            } catch (error) {
                                console.error('Auth check failed:', error);
                                window.location.href = 'login.html';
                            }
                        } else {
                            // No credentials configured in config.js, redirect to login
                            console.error('Please configure SUPABASE_URL and SUPABASE_ANON_KEY in config.js');
                            window.location.href = 'login.html';
                        }
                    });
                </script>
                <input type="hidden" id="postId">
                <div class="form-group">
                    <label class="form-label">Platform *</label>
                    <select id="platform" class="form-select" required>
                        <option value="">Select platform...</option>
                        <option value="instagram">üì∏ Instagram</option>
                        <option value="facebook">üìò Facebook</option>
                        <option value="linkedin">üíº LinkedIn</option>
                        <option value="twitter">üê¶ Twitter/X</option>
                        <option value="youtube">üì∫ YouTube</option>
                        <option value="tiktok">üéµ TikTok</option>
                        <option value="telegram">‚úàÔ∏è Telegram</option>
                        <option value="pinterest">üìå Pinterest</option>
                        <option value="whatsapp">üí¨ WhatsApp Business</option>
                        <option value="discord">üéÆ Discord</option>
                        <option value="forum">üí≠ Forum</option>
                </div>
                <div class="form-group">
                    <label class="form-label">Title *</label>
                    <input type="text" id="title" class="form-input" placeholder="Post title..." required>
                </div>
                <div class="form-group">
                    <label class="form-label">Content *</label>
                    <textarea id="content" class="form-textarea" placeholder="Post content..." required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex:1;">
                        <label class="form-label">Date *</label>
                        <input type="date" id="scheduledDate" class="form-input" required>
                    </div>
                    <div class="form-group" style="flex:1;">
                        <label class="form-label">Time</label>
                        <input type="time" id="scheduledTime" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Image URL</label>
                    <input type="url" id="imageUrlInput" class="form-input" placeholder="Paste Cloudflare R2 or image URL..." onchange="handleImageUrlInput(event)">
                    <img id="imagePreview" style="display:none; max-width:100%; margin-top:10px; border-radius:8px;">
                </div>
                <div style="display:flex; gap:1rem; margin-top:2rem;">
                    <button type="submit" class="btn btn-success" style="flex:1;">Save</button>
                    <button type="button" class="btn btn-secondary" onclick="closePostModal()">Cancel</button>
                    <button type="button" id="deleteBtn" class="btn btn-danger" style="display:none;" onclick="handleDeletePost()">Delete</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Jan AI Assistant Chat Overlay -->
    <div id="janChatOverlay" class="jan-chat-overlay">
        <div class="jan-chat-container">
            <div class="jan-chat-header">
                <div class="jan-header-left">
                    <img src="public/jan-profile.png" alt="Jan" class="jan-header-avatar">
                    <div>
                        <h3>Jan - AI Assistant</h3>
                        <p class="jan-status"><span class="status-dot"></span>Online</p>
                    </div>
                </div>
                <button class="jan-close-btn" onclick="toggleJanChat()">&times;</button>
            </div>
            
            <div class="jan-chat-body" id="janChatBody">
                <!-- Character Profile Selection -->
                <div class="jan-form-group">
                    <label>Character Profile</label>
                    <div class="jan-character-profiles">
                        <div class="jan-character-option">
                            <input type="radio" id="janAnica" name="janCharacter" value="Anica">
                            <label for="janAnica" class="jan-character-label">Anica</label>
                        </div>
                        <div class="jan-character-option">
                            <input type="radio" id="janCaelum" name="janCharacter" value="Caelum">
                            <label for="janCaelum" class="jan-character-label">Caelum</label>
                        </div>
                        <div class="jan-character-option">
                            <input type="radio" id="janAurion" name="janCharacter" value="Aurion">
                            <label for="janAurion" class="jan-character-label">Aurion</label>
                        </div>
                    </div>
                </div>

                <!-- Theme/Label -->
                <div class="jan-form-group">
                    <label for="janThemeLabel">Theme/Label</label>
                    <select id="janThemeLabel" class="jan-form-control">
                        <option value="">Select theme...</option>
                        <option value="News Alert">News Alert</option>
                        <option value="Promotion">Promotion</option>
                        <option value="Standard Post">Standard Post</option>
                        <option value="CTA - Quiz">CTA - Quiz</option>
                        <option value="CTA - Game">CTA - Game</option>
                        <option value="CTA - Puzzle">CTA - Puzzle</option>
                        <option value="CTA - Challenge">CTA - Challenge</option>
                        <option value="News">News</option>
                        <option value="Blog">Blog</option>
                        <option value="Tutorial Guide">Tutorial Guide</option>
                        <option value="Course, Tool">Course, Tool</option>
                        <option value="Assessment">Assessment</option>
                    </select>
                </div>

                <!-- Brand Voice Style -->
                <div class="jan-form-group">
                    <label for="janBrandVoice">Brand Voice Style</label>
                    <select id="janBrandVoice" class="jan-form-control">
                        <option value="">Select brand voice...</option>
                        <option value="Casual">Casual</option>
                        <option value="Friendly">Friendly</option>
                        <option value="Professional">Professional</option>
                        <option value="Creative">Creative</option>
                    </select>
                </div>

                <!-- Target Audience -->
                <div class="jan-form-group">
                    <label for="janTargetAudience">Target Audience</label>
                    <select id="janTargetAudience" class="jan-form-control">
                        <option value="">Select audience...</option>
                        <option value="Existing Members">Existing Members</option>
                        <option value="New Members">New Members</option>
                        <option value="Persona FALCON">Persona FALCON</option>
                        <option value="Persona PANTHER">Persona PANTHER</option>
                        <option value="Persona WOLF">Persona WOLF</option>
                        <option value="Persona LION">Persona LION</option>
                        <option value="General Public">General Public</option>
                    </select>
                </div>

                <!-- Template Type -->
                <div class="jan-form-group">
                    <label for="janTemplateType">Template Type</label>
                    <select id="janTemplateType" class="jan-form-control">
                        <option value="">Select template...</option>
                        <option value="Social Media">Social Media</option>
                        <option value="Presentation">Presentation</option>
                        <option value="Video Message">Video Message</option>
                        <option value="Anica Chat">Anica Chat</option>
                        <option value="Blog Posts">Blog Posts</option>
                        <option value="News Article">News Article</option>
                        <option value="Newsletter">Newsletter</option>
                        <option value="Email Templates">Email Templates</option>
                        <option value="Custom Templates">Custom Templates</option>
                    </select>
                </div>

                <!-- Select Platform -->
                <div class="jan-form-group">
                    <label for="janPlatform">Select Platform</label>
                    <select id="janPlatform" class="jan-form-control">
                        <option value="">Select platform...</option>
                        <option value="Instagram">Instagram</option>
                        <option value="Facebook">Facebook</option>
                        <option value="LinkedIn">LinkedIn</option>
                        <option value="Twitter/X">Twitter/X</option>
                        <option value="YouTube">YouTube</option>
                        <option value="TikTok">TikTok</option>
                        <option value="Telegram">Telegram</option>
                        <option value="Pinterest">Pinterest</option>
                        <option value="WhatsApp Business">WhatsApp Business</option>
                        <option value="Discord">Discord</option>
                        <option value="Forum">Forum</option>
                    </select>
                </div>

                <!-- Content Prompt - Specific Requirements -->
                <div class="jan-form-group" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #667eea;">
                    <label for="janPrompt" style="color: #667eea; font-weight: 600;">üí≠ Content Prompt - Specific Requirements</label>
                    <textarea id="janPrompt" class="jan-form-control jan-textarea" 
                            placeholder="Add specific requirements or notes for Jan (e.g., 'add CLICK BUTTON in the message', 'include emoji', 'keep it short and punchy')..." 
                            rows="3"></textarea>
                    <small style="color: #718096; font-size: 11px;">Short notes to guide Jan on what you need</small>
                </div>

                <!-- Social Media Output Fields -->
                <div class="jan-output-section">
                    <h4 style="margin: 16px 0 12px 0; color: #667eea; font-size: 14px; font-weight: 600;">üì± Social Media Output</h4>
                    
                    <!-- Title -->
                    <div class="jan-form-group">
                        <label for="janTitle">Title</label>
                        <input type="text" id="janTitle" class="jan-form-control" 
                               placeholder="Content title...">
                    </div>

                    <!-- Description -->
                    <div class="jan-form-group">
                        <label for="janDescription">Description</label>
                        <textarea id="janDescription" class="jan-form-control jan-textarea" 
                                  placeholder="Post description (platform-aware character count)..." 
                                  rows="4"></textarea>
                        <small id="janDescCharCount" style="color: #718096; font-size: 11px;">0 characters</small>
                    </div>

                    <!-- Hashtags -->
                    <div class="jan-form-group">
                        <label for="janHashtags">Hashtags</label>
                        <input type="text" id="janHashtags" class="jan-form-control" 
                               placeholder="#ThinkItDoItOwnIt #WeRiseAsOne #ContentSpecific" 
                               readonly>
                        <small style="color: #718096; font-size: 11px;">Auto-generated by Jan</small>
                    </div>

                    <!-- SEO Keywords -->
                    <div class="jan-form-group">
                        <label for="janSEOKeywords">SEO Keywords</label>
                        <input type="text" id="janSEOKeywords" class="jan-form-control" 
                               placeholder="keyword1, keyword2, keyword3...">
                    </div>

                    <!-- CTA -->
                    <div class="jan-form-group">
                        <label for="janCTA">CTA (Call-to-Action)</label>
                        <input type="text" id="janCTA" class="jan-form-control" 
                               placeholder="e.g., Join us today, Learn more, Take the quiz...">
                    </div>
                </div>

                <!-- Schedule/Timestamp -->
                <div class="jan-form-group">
                    <label>Schedule/Timestamp</label>
                    <div class="jan-datetime-group">
                        <div>
                            <label for="janScheduleDate">Date</label>
                            <input type="date" id="janScheduleDate" class="jan-form-control">
                        </div>
                        <div>
                            <label for="janScheduleTime">Time</label>
                            <input type="time" id="janScheduleTime" class="jan-form-control">
                        </div>
                    </div>
                </div>

                <!-- Chat Messages -->
                <div class="jan-chat-messages" id="janChatMessages">
                    <div class="jan-message jan-ai">
                        <div class="jan-message-content">
                            <strong>Jan:</strong> Hello! I'm Jan, your AI content assistant. Fill out the form above and I'll help you create engaging content for your schedule.
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="jan-chat-footer">
                <div class="jan-quick-actions">
                    <button class="jan-quick-btn" onclick="janRequestClarification()">Need Clarification</button>
                    <button class="jan-quick-btn" onclick="janRescheduleContent()">Re-schedule</button>
                    <button class="jan-quick-btn" onclick="janRepurposeContent()">Repurpose Content</button>
                    <button class="jan-quick-btn" onclick="janReviewContent()">Review Changes</button>
                </div>
                <div class="jan-input-group">
                    <input type="text" id="janChatInput" class="jan-chat-input" placeholder="Ask Jan for help or clarification..." onkeypress="handleJanEnter(event)">
                    <button class="jan-send-btn" onclick="sendJanMessage()">
                        <span>Send</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/supabaseAPI.js?v=1.1.2"></script>
    <script src="js/app.js?v=1.1.2"></script>
    <script src="js/navigation.js?v=1.0.3"></script>
    <script src="js/jan-chat.js"></script>
</body>
</html>
